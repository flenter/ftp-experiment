box: wercker/default
services:
  - wercker/mysql
build:
  steps:
    - install-packages:
        packages: sshpass
    - script:
        name: add to host file
        code:
          echo "$WERCKER_MYSQL_HOST mysql"| sudo tee -a /etc/hosts
    - script:
        name: set CUSTOM_THING
        code: |
          cat /etc/hosts
    - script:
        name: add to known host
        code: |
          export WERCKER_ADD_TO_KNOWN_HOSTS_HOSTNAME="mysql"
          source  ./run.sh
    - script:
        name: copying files
        code: |
          export MY_PASSWORD="ubuntu"
          sshpass -p $MY_PASSWORD scp run.sh ubuntu@mysql:/home/ubuntu
    - script:
        name: validate result
        code: |
          mkdir result
          sshpass -p $MY_PASSWORD scp ubuntu@mysql:/home/ubuntu/run.sh result
          diff run.sh result/run.sh
